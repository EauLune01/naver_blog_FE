<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SG Blog</title>
    <style>

        html, body {
            min-width:1280px;
            overflow-y:auto;
            overflow-x: auto;
        }

        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }

        

/*í—¤ë” ë¶€ë¶„*/        
        .header {
            display: flex;
            justify-content: space-between; /* ì¢Œìš°ë¡œ ê· ë“± ë°°ì¹˜ */
            align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
            padding: 5px 17%; /* ì¢Œìš° íŒ¨ë”© ì„¤ì • */
            background-color: #f1d1d3;
            color: white;
        }

        .header .logo {
            display: flex;
            align-items: center;
        }


        .header .logo {
            height: 49px; /* ê³ ì •ëœ ë¡œê³  í¬ê¸° */
            width: auto; /* ë¹„ìœ¨ ìœ ì§€ */
            margin: 1px; /* margin (ì´ë¯¸ì§€ë¥¼ ë‘˜ëŸ¬ì‹¸ëŠ” ì—¬ë°±ì˜ í­) ì œê±° */
            transition: margin-left 0.3s ease;
            font-size:27px;
            font-weight:800;

        }

        .header .search {
            display: flex;
            justify-content: center;
            align-items: center;
        }


        .header .search input {
            width: 60%; /* ê²€ìƒ‰ì°½ ë„ˆë¹„ */
            padding: 12px;
            border: none;
            border-radius: 0px;
            margin-right: 300px;
            border-color: #f1d1d3;

        }

        .header .search button { /*ìœ—ì¤„ ê²€ìƒ‰ ë²„íŠ¼*/
            padding: 11px 13px;
            border: none;
            background-color: #da9d9c;
            border-color: #da9d9c;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            margin-left:-193px;
        }

        
        .header .search button:hover {
            background-color: #861f1c;
        }

        .header .menu {
            display: flex;
        }



        .header .menu button {
            background-color: #da9d9c;
            color: #fff;
            border: none;
            padding: 11px 16px;
            border-radius:2px;
            cursor: pointer;
            font-weight: bold;
        }

        .header .menu button:hover {
            background-color: #861f1c;
        }
        
        


        .search select {
            width:100%;
            padding:11.8px;
            border: 0.05px solid;
            border-color: #da9d9c;
            margin-right:20px;
        }
        
        

        .main-container {
            display: flex;
            justify-content: space-between;
            margin: 20px;
        }

        




/*ì˜¤ë¥¸ìª½ ë¡œê·¸ì¸ ë°•ìŠ¤ë¶€ë¶„*/
        .right-column {
            width: 350px; /* ë¡œê·¸ì¸ ë°•ìŠ¤ ë„ˆë¹„ */
            height:180px;
            background-color: #fff;
            padding: 27px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .login-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .login-text {
            font-size: 14px;
            color: gray;
            text-align: center;
        }

        .naver-login-btn {
            width: 100%;
            padding: 15px;
            background-color: #da9d9c;
            color: white;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .naver-login-btn:hover {
            background-color: #861f1c;
        }

        .login-links {
            font-size: 12.5px;
            color: #666;
        }

        .login-links a {
            color: #666;
            text-decoration: none;
        }

        .login-links a:hover {
            text-decoration: underline;
        }



/*ì™¼ìª½ ë¶€ë¶„*/
        .left-column {
            width: 80%;
            padding: 20px;
        }

/* ë¡œê·¸ì•„ì›ƒ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .logout-message {
            text-align: center;
            margin-bottom: 50px;
        }

        .logout-message p {
            font-size: 18px;
            color: #666;
            font-weight: bold;
            margin: 5px;
        }

/* ì¹´í…Œê³ ë¦¬ ë„¤ë¹„ê²Œì´ì…˜ */
        .category-nav {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .category-nav ul {
            list-style: none;
            display: flex;
            padding: 0;
            border-bottom: 2.5px solid #ddd;
            border-top: 2.5px solid #ddd;
        }

        .category-nav li {
            margin-right: 30px;
        }

        .category-nav a {
            display: block;
            padding: 10px 15px;
            font-size: 14px;
            color: black;
            text-decoration: none;
        }

        .category-nav a:hover, 
        .category-nav a.active {
            color: #861f1c;
            font-weight: bold;
            border-bottom: 3px solid #861f1c;
        }

/* ê¸€ ëª©ë¡ ìŠ¤íƒ€ì¼ */
        .post-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

/* ê°œë³„ ê¸€ */
        .post {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

/* ì‘ì„±ì ì •ë³´ */
        .post-author {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .post-author img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .author-name {
            font-size: 14px;
            font-weight: bold;
        }

        .time {
            font-size: 12px;
            color: gray;
            margin-top:6px;
        }

/* ê¸€ ë‚´ìš© */
        .post-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .post-text {
            flex: 1;
        }

        .post-text h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .post-text p {
            font-size: 14px;
            color: gray;
        }

        .post-meta {
            font-size: 12px;
            color: gray;
            margin-top:13px;
        }

        .post-content img {
            width: 120px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
        }


    </style>
</head>

<body>
    <header class="header">
        <!-- ë¡œê³  -->
        <div class="logo">SG blog</div>


        <!-- ê²€ìƒ‰ ì˜ì—­ -->
        <div class="search">
            <div class="search-select">
                <label for="search-type" class="visually-hidden"></label>
                <select id="search-type" name="type">
                    <option value="geul">ê¸€</option>
                    <option value="blog">ë¸”ë¡œê·¸</option>
                    <option value="id">ë³„ëª…, ì•„ì´ë””</option>
                </select>
            </div>

            <div class="search-input">
                <label for="search-input" class="visually-hidden"></label>
                <input id="search-input" type="text" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>

            <button class="search-button">ê²€ìƒ‰</button>
        </div>

        <!-- ë©”ë‰´ ë²„íŠ¼ -->
        <div class="menu">
            <button onclick="location.href='login.html'">ë¡œê·¸ì¸</button>
        </div>
    </header>

    <div class="main-container">
        <div class="left-column">
            <!-- ë¡œê·¸ì•„ì›ƒ ë©”ì‹œì§€ -->
            <div class="logout-message">
                <p>ë¡œê·¸ì•„ì›ƒ ìƒíƒœì…ë‹ˆë‹¤.</p>
                <p>ë¡œê·¸ì¸í•˜ì—¬ ì´ì›ƒìƒˆê¸€ì„ í™•ì¸í•´ë³´ì„¸ìš”.</p>
            </div>
        
            <!-- ì¹´í…Œê³ ë¦¬ ë„¤ë¹„ê²Œì´ì…˜ -->
            <nav class="category-nav">
                <ul>
                    <li><a href="main.html">ì „ì²´</a></li>
                    <li><a href="main1.html"  class="active">ì—”í„°í…Œì¸ë¨¼íŠ¸/ì˜ˆìˆ </a></li>
                    <li><a href="main2.html">ìƒí™œ/ë…¸í•˜ìš°/ì‡¼í•‘</a></li>
                    <li><a href="main3.html">ì·¨ë¯¸/ì—¬ê°€/ì—¬í–‰</a></li>
                    <li><a href="main4.html">ì§€ì‹/ë™í–¥</a></li>
                </ul>
            </nav>
        
            <!-- ì „ì²´ ê³µê°œëœ ê¸€ ëª©ë¡ -->
            <div class="post-list">
                <div class="post">
                    <div class="post-author">
                        <img src="assets/profile.png" alt="í”„ë¡œí•„">
                        <div>
                            <div class="author-name">ã…‡ã…‡</div>
                            <div class="time">7ì‹œê°„ ì „</div>
                        </div>
                    </div>
                    <div class="post-content">
                        <div class="post-text">
                            <h3>ìƒí’ˆ ë¦¬ë·°í•©ë‹ˆë‹¤!</h3>
                            <p>ì•ˆë…•í•˜ì„¸ìš”!</p>
                            <div class="post-meta">
                                <span>ê³µê° 66</span> Â· <span>ëŒ“ê¸€ 18</span>
                            </div>
                        </div>
                        <img src="https://via.placeholder.com/120" alt="ëŒ€í‘œì‚¬ì§„">
                    </div>
                </div>
        
                <div class="post">
                    <div class="post-author">
                        <img src="assets/profile.png" alt="í”„ë¡œí•„">
                        <div>
                            <div class="author-name">ì‚¬ìš©ì</div>
                            <div class="time">9ì‹œê°„ ì „</div>
                        </div>
                    </div>
                    <div class="post-content">
                        <div class="post-text">
                            <h3>ëƒ‰ì¥ê³  í›„ê¸°</h3>
                            <p>ã…‡ã…‡ã…‡</p>
                            <div class="post-meta">
                                <span>ê³µê° 49</span> Â· <span>ëŒ“ê¸€ 3</span>
                            </div>
                        </div>
                        <img src="https://via.placeholder.com/120" alt="ëŒ€í‘œì‚¬ì§„">
                    </div>
                </div>
            </div>
        </div>
        
        
        

        <div class="right-column">
            <div class="login-box">
                <p class="login-text">ë„¤ì´ë²„ë¥¼ ë³´ë‹¤ í¸ë¦¬í•˜ê³  ì•ˆì „í•˜ê²Œ ì´ìš©í•˜ì„¸ìš”.</p>
                <button class="naver-login-btn"  onclick="location.href='login.html'">NAVER ë¡œê·¸ì¸</button>
                <div class="login-links">
                    <a href="#">ì•„ì´ë”” ì°¾ê¸°</a> Â· <a href="#">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a> Â· <a href="signin.html">íšŒì›ê°€ì…</a>
                </div>
            </div>
        </div>
        
    </div>

    <script>

document.addEventListener("DOMContentLoaded", async () => {
    const postList = document.querySelector(".post-list"); // ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ
    const apiUrl = "http://127.0.0.1:8000/posts/?keyword=%EC%97%94%ED%84%B0%ED%85%8C%EC%9D%B8%EB%A8%BC%ED%8A%B8%2F%EC%98%88%EC%88%A0"; // ë°±ì—”ë“œ ì—”ë“œí¬ì¸íŠ¸
    const accessToken = localStorage.getItem("access_token");

    try {
        const response = await fetch(apiUrl, {
            method: "GET",
            headers: {
                "Accept": "application/json",
                "Authorization": `Bearer ${accessToken}`, // í† í° ì „ë‹¬
            }
        });

        if (!response.ok) {
            throw new Error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        }

        const posts = await response.json();
        window.posts = posts; // âœ… ì „ì—­ ë³€ìˆ˜ ì €ì¥

        postList.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ë¹„ìš°ê¸°

        if (posts.length === 0) {
            postList.innerHTML = "<p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
        }

        // âœ… `url_name`ì„ ì´ìš©í•´ í”„ë¡œí•„ ì´ë¯¸ì§€(user_pic) ê°€ì ¸ì˜¤ê¸° (ë¹„ë™ê¸° ë³‘ë ¬ ì²˜ë¦¬)
        const profileImages = await fetchProfileImages(posts);

        // âœ… ê²Œì‹œê¸€ì„ ë™ì ìœ¼ë¡œ ì¶”ê°€
        posts.forEach(post => {
            const { id, user_name, title, content, likes, comments, created_at, images, url_name } = post;

            // âœ… í”„ë¡œí•„ ì´ë¯¸ì§€ ì ìš© (profile APIì—ì„œ ê°€ì ¸ì˜¨ ê°’ ì‚¬ìš©)
            let profileImageUrl = profileImages[url_name] || `http://127.0.0.1:8000/media/default/user_default.jpg`;

            // âœ… ë³¸ë¬¸ ê¸€ì ìˆ˜ ì œí•œ ë° HTML íƒœê·¸ ì œê±°
            let previewText = content
                .replace(/<[^>]*>/g, "") // ëª¨ë“  HTML íƒœê·¸ ì œê±°
                .replace(/ëŒ€í‘œì‚¬ì§„ ì„ íƒ/g, "")
                .replace(/ì´ë¯¸ì§€ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”\.\.\./g, "")
                .trim();
            previewText = previewText.length > 125 ? previewText.substring(0, 125) + "..." : previewText;

            // âœ… ëŒ€í‘œ ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸°
            let representativeImage = "";
            if (images && images.length > 0) {
                const repImage = images.find(img => img.is_representative);
                if (repImage) {
                    representativeImage = `<div class="post-right"><img src="${repImage.image}" alt="ëŒ€í‘œ ì´ë¯¸ì§€" class="post-thumbnail"></div>`;
                }
            }

            // âœ… ë‚ ì§œ í¬ë§· ë³€ê²½
            let dateObj = new Date(created_at);
            let formattedDate = `${dateObj.getFullYear()}. ${dateObj.getMonth() + 1}. ${dateObj.getDate()} ${dateObj.getHours()}:${String(dateObj.getMinutes()).padStart(2, '0')}`;

            // âœ… ê²Œì‹œê¸€ HTML ìƒì„±
            const postElement = document.createElement("div");
            postElement.classList.add("post");
            postElement.dataset.id = id;
            postElement.dataset.urlName = url_name;
            postElement.innerHTML = `
                <div class="post-author">
                    <img src="${profileImageUrl}" alt="í”„ë¡œí•„" class="profile-pic">
                    <div>
                        <div class="author-name">${user_name || "ìµëª…"}</div>
                        <div class="time">${formattedDate}</div>
                    </div>
                </div>
                <div class="post-content">
                    <div class="post-left">
                        <h3 class="post-title">${title}</h3>
                        <p class="post-text">${previewText}</p>
                        <div class="post-meta">
                            <span class="heart" data-id="${id}">ğŸ¤</span> 
                            <span class="heart-count" id="like-count-${id}">${likes || 0}</span> Â· 
                            <span>ğŸ’¬ ${comments || 0}</span>
                        </div>
                    </div>
                    ${representativeImage}
                </div>
            `;

            postList.appendChild(postElement);
        });

    } catch (error) {
        console.error("âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜:", error);
        postList.innerHTML = "<p>ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>";
    }
});

// âœ… `url_name`ì„ ì´ìš©í•´ í”„ë¡œí•„ ì´ë¯¸ì§€(user_pic) ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ (ë¹„ë™ê¸° ë³‘ë ¬ ìš”ì²­)
async function fetchProfileImages(posts) {
    const urlNames = [...new Set(posts.map(post => post.url_name))]; // âœ… ì¤‘ë³µ ì œê±°ëœ url_name ëª©ë¡
    const profileImageMap = {}; // âœ… url_name -> user_pic ì €ì¥í•  ê°ì²´

    await Promise.all(urlNames.map(async (urlName) => {
        try {
            const response = await fetch(`http://127.0.0.1:8000/profile/${urlName}/`, {
                method: "GET",
                headers: {
                    "Accept": "application/json",
                    "Authorization": `Bearer ${localStorage.getItem("access_token")}`, // í† í° ì „ë‹¬
                }
            });

            if (!response.ok) {
                throw new Error(`âŒ í”„ë¡œí•„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (urlname: ${urlName})`);
            }

            const data = await response.json();
            profileImageMap[urlName] = data.user_pic || `http://127.0.0.1:8000/media/default/user_default.jpg`;

        } catch (error) {
            console.error(`âŒ í”„ë¡œí•„ ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜ (urlname: ${urlName}):`, error);
        }
    }));

    return profileImageMap;
}

// âœ… ê²Œì‹œê¸€ í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ ì´ë™ (ì´ë²¤íŠ¸ ìœ„ì„ ë°©ì‹)
document.querySelector(".post-list").addEventListener("click", function (event) {
    const post = event.target.closest(".post");
    if (!post || event.target.classList.contains("heart")) {
        return; // ğŸ›‘ í•˜íŠ¸ í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ ì´ë™ ë°©ì§€
    }

    const postId = post.getAttribute("data-id");
    const postData = window.posts.find(post => post.id == postId); // âœ… ì „ì—­ ë³€ìˆ˜ ì‚¬ìš©

    if (!postData || !postData.url_name) {
        console.error("âŒ í•´ë‹¹ postIdì— ëŒ€í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:", postId);
        return;
    }

    const urlName = postData.url_name;
    window.location.href = `blog_detail.html?urlname=${urlName}&post_id=${postId}`;
});



    </script>
</body>
</html>


        