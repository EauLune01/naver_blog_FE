<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="prolog.css" />
    <title>SG Blog</title>
  
    <script>
      function popup() {
        var url = "./neighbor_request.html";
        var name = "_blank";
        var option =
          "width = 480, height = 300, top = 100, left = 200, location = no";
        window.open(url, name, option);
      }
    </script>
  </head>

  <body>
    <div id="top-area">
      <div class="top_menubar">
        <a
          id="bloghome-link"
          href="#"
          style="color: black; text-decoration-line: none"
          >ë¸”ë¡œê·¸ í™ˆ</a
        >
        <a style="color: gray"> | </a>
        <button id="login-btn" href="./login.html">ë¡œê·¸ì¸</button>
      </div>

      <div class="itemtitlefont" id="blogTitleName">ë¸”ë¡œê·¸ ì œëª©ì…ë‹ˆë‹¹</div>

      <div id="blog-menu">
        <div class="border">
          <table>
            <tbody>
              <tr>
                <td nowrap="nowrap" class="menu1">
                  <ul>
                    <li>
                      <a
                        id="prolog-link"
                        href="#"
                        style="color: black; text-decoration-line: none"
                        >í”„ë¡¤ë¡œê·¸</a
                      >
                    </li>
                    <li>|</li>
                    <li>
                      <a style="color: #861f1c; font-weight: bold">ë¸”ë¡œê·¸</a>
                    </li>
                  </ul>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <hr style="margin-left: 140px" />
    </div>

    <!-- í”„ë¡œí•„ -->
    <div class="bg-body">
      <div class="con">
        <p class="image">
          <a href="#">
            <img
              class="user-profilepicture"
              style="width: 135px"
              src="assets/profile.png"
              alt="í”„ë¡œí•„ ì´ë¯¸ì§€"
            />
          </a>
        </p>
      </div>
      <div class="name align">
        <div class="user-nickname" style="font-size: 15px">
          <strong class="itemfont col" id="nickNameArea">ì‚¬ìš©ìì´ë¦„</strong>
          <br />
          <span class="itemfont col">
            <span class="blog_domain col"></span>
          </span>
        </div>
      </div>
      <p class="caption align">
        <span class="itemfont_col">í”„ë¡œí•„ ì†Œê°œ</span>
      </p>
      <p class="more align"><span class="m1"></span></p>

      <!-- ì´ì›ƒ ì¶”ê°€ ë²„íŠ¼ (popup ì—†ì´ ì§ì ‘ ì‹ ì²­) -->
      <div class="btn_area" id="neighbor-btn">
        <span class="blind">ì´ì›ƒì¶”ê°€</span>
      </div>
    </div>

    <!-- âœ… ì¹´í…Œê³ ë¦¬ ë¦¬ìŠ¤íŠ¸ UI -->
    <div class="bg-category">
      <ul id="categoryList"></ul>
    </div>

    <!--ì„œë¡œì´ì›ƒ-->
    <div class="bg-neighbor">
      <div class="neighbor-profile">
        <div class="user-nickname" style="font-size: 15px">
          <strong></strong>
        </div>
        <div>ì´ì›ƒ ì»¤ë„¥íŠ¸</div>
      </div>
      <div class="neighbor-list">
        <div class="all_neighborhood">
          <span>ì „ì²´ ì´ì›ƒ</span>
          <span id="neighbor-count" style="margin-left: 10px; color: green"
            >0</span
          ><span>ëª…</span>
          <hr style="width: 95%; border: 0.25px solid gray" />
        </div>
        <div
          id="neighbor-container"
          style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px"
        ></div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div id="pagination" style="text-align: center; margin-top: 10px">
          <span id="page-indicator">1 / 1</span>
          <button
            id="prev-page"
            style="background: none; border: none; cursor: pointer"
          >
            â—€
          </button>
          <button
            id="next-page"
            style="background: none; border: none; cursor: pointer"
          >
            â–¶
          </button>
        </div>

        <hr style="width: 80%; border: 0.25px solid gray" />
        <a
          id="neighbor-new-posts"
          href="main_login.html"
          style="margin-left: 10px; font-size: 13px; color: gray"
        ></a>
      </div>
    </div>

    <!-- í¬ìŠ¤íŠ¸ ëª©ë¡ -->
    <div class="pro_posts">
      <div class="post_list">
        <div class="post_list_title">
          <strong>ì „ì²´ë³´ê¸°</strong> <a id="post-count">?ê°œì˜ ê¸€</a>
        </div>
        <div style="display: none" class="post_list_contents">
          <div class="post_list_content_title">
            <a>ê¸€ ì œëª©</a><a style="float: right">ì‘ì„±ì¼</a>
          </div>
          <hr class="post_list_hr" />
          <div class="post_list_contents_list">
            <div>
              <a>ê¸€ ì œëª©1</a><a style="float: right">2024.02.10</a>
              <hr class="post_list_contents_hr" />
            </div>
            <div>
              <a>ê¸€ ì œëª©2</a><a style="float: right">2024.02.10</a>
              <hr class="post_list_contents_hr" />
            </div>
          </div>
        </div>
      </div>
      <div class="post_content"></div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        // í˜„ì¬ URLì—ì„œ urlname ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const urlname = urlParams.get("urlname");

        if (urlname) {
          try {
            // ì„œë²„ API ìš”ì²­
            const response = await fetch(
              `http://127.0.0.1:8000/posts/count/${urlname}/`
            );
            if (!response.ok) throw new Error("ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜");

            const data = await response.json();

            // post_count ê°’ì„ HTMLì— ì‚½ì…
            document.getElementById(
              "post-count"
            ).textContent = `${data.post_count}ê°œì˜ ê¸€`;
          } catch (error) {
            console.error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
          }
        } else {
          console.warn("urlname ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ê°€ ì—†ìŒ");
        }
      });
    </script>

    <!-- âœ… ì¹´í…Œê³ ë¦¬ ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” JS ì½”ë“œ ì‹¤í–‰ -->
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        try {
          console.log("ğŸ” DOMContentLoaded ì‹¤í–‰ë¨");

          // âœ… `blog.html`ì—ì„œëŠ” URL ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì—ì„œ `urlname` ê°€ì ¸ì˜¤ê¸°
          const urlParams = new URLSearchParams(window.location.search);
          const urlname = urlParams.get("urlname");

          if (!urlname) {
            console.error("âŒ ì˜¤ë¥˜: ë¸”ë¡œê·¸ì˜ `urlname`ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
          }

          console.log("ğŸ“Œ ë¸”ë¡œê·¸ ì£¼ì¸ì˜ URLNAME:", urlname);

          // âœ… `urlname`ì„ ì´ìš©í•´ì„œ ì¹´í…Œê³ ë¦¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
          await fetchCategories(urlname);
        } catch (error) {
          console.error(
            "âŒ ë¸”ë¡œê·¸ì˜ `urlname`ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:",
            error
          );
        }
      });

      // âœ… ì¹´í…Œê³ ë¦¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
      async function fetchCategories(urlname) {
        try {
          const response = await fetch(
            `http://127.0.0.1:8000/category/?urlname=${encodeURIComponent(
              urlname
            )}`,
            {
              method: "GET",
              headers: {
                Authorization: `Bearer ${localStorage.getItem("access_token")}`,
                "Content-Type": "application/json",
              },
            }
          );

          if (!response.ok) {
            console.error(
              `âŒ ì¹´í…Œê³ ë¦¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ìƒíƒœ ì½”ë“œ: ${response.status})`
            );
            return;
          }

          const categories = await response.json();
          console.log("ğŸ“¢ ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë°ì´í„°:", categories);

          // âœ… ì¹´í…Œê³ ë¦¬ UI ì—…ë°ì´íŠ¸
          updateCategoryUI(categories);
        } catch (error) {
          console.error("âŒ ì¹´í…Œê³ ë¦¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
        }
      }

      // âœ… UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      function updateCategoryUI(categories) {
    const categoryListContainer = document.getElementById("categoryList");

    if (!categoryListContainer) {
        console.error("âŒ 'categoryList' ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    categoryListContainer.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

    if (!categories || categories.length === 0) {
        categoryListContainer.innerHTML = "<li>ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</li>";
        return;
    }

    // âœ… "ì „ì²´ë³´ê¸°"ì™€ "ê²Œì‹œíŒ" ë¨¼ì € ì¶”ê°€
    const sortedCategories = ["ì „ì²´ë³´ê¸°", "ê²Œì‹œíŒ"];

    // âœ… "ê²Œì‹œíŒ" ì œì™¸í•˜ê³  idìˆœ ì •ë ¬ í›„ ì¶”ê°€
    categories
        .sort((a, b) => a.id - b.id)
        .forEach((category) => {
            if (category.name !== "ê²Œì‹œíŒ") {
                sortedCategories.push(category.name);
            }
        });

    // âœ… ì •ë ¬ëœ ì¹´í…Œê³ ë¦¬ ë¦¬ìŠ¤íŠ¸ë¥¼ UIì— ì¶”ê°€ (í•œ ì¤„ì”© ë‚˜ì˜¤ë„ë¡)
    sortedCategories.forEach((name) => {
        const li = document.createElement("li");
        li.textContent = name;
        li.classList.add("category-item"); // âœ… CSS ì ìš©ì„ ìœ„í•œ í´ë˜ìŠ¤ ì¶”ê°€
        categoryListContainer.appendChild(li);

        console.log(`âœ… ì¶”ê°€ëœ ì¹´í…Œê³ ë¦¬: ${name}`, li); // âœ… ì¶”ê°€ëœ ì¹´í…Œê³ ë¦¬ í™•ì¸
    });

    console.log("ğŸ“¢ ì¹´í…Œê³ ë¦¬ UI ì—…ë°ì´íŠ¸ ì™„ë£Œ!");
}


    </script>

    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        const neighborButton = document.getElementById("neighbor-btn");

        if (!neighborButton) {
          console.error("âŒ ì˜¤ë¥˜: ì´ì›ƒ ì¶”ê°€ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ");
          return;
        }

        const neighborText = neighborButton.querySelector(".blind");
        const accessToken = localStorage.getItem("access_token");

        if (!accessToken) {
          console.log("ğŸ”¹ ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ì‚¬ìš©ì (ì´ì›ƒ ë²„íŠ¼ ë¹„í™œì„±í™”)");
          return; // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° ë²„íŠ¼ ë¹„í™œì„±í™”
        }

        // ğŸ”¹ URLì—ì„œ ë¸”ë¡œê·¸ ì£¼ì¸ì˜ urlname ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const toUrlname = urlParams.get("urlname"); // âœ… ë³€ê²½ëœ ë¶€ë¶„ (user â†’ urlname)

        if (!toUrlname) {
          console.error("âŒ ì˜¤ë¥˜: ë¸”ë¡œê·¸ ì£¼ì¸ì˜ urlnameì´ ì—†ìŒ");
          return;
        }

        try {
          // âœ… í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì˜ í”„ë¡œí•„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          const profileResponse = await fetch(
            "http://127.0.0.1:8000/profile/me/",
            {
              method: "GET",
              headers: {
                Authorization: `Bearer ${accessToken}`,
                "Content-Type": "application/json",
              },
            }
          );

          if (!profileResponse.ok) {
            console.error(
              "âŒ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:",
              profileResponse.status
            );
            return;
          }

          const profileData = await profileResponse.json();
          const myUrlname = profileData.urlname; // âœ… í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì˜ urlname (ì˜ˆ: chsm7288)

          console.log(`ğŸ”¹ í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì: ${myUrlname}`);
          console.log(`ğŸ”¹ íƒ€ì¸ì˜ ë¸”ë¡œê·¸: ${toUrlname}`);

          // âœ… íƒ€ì¸ì˜ ì´ì›ƒ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
          const neighborsResponse = await fetch(
            `http://127.0.0.1:8000/profile/${toUrlname}/neighbors/`
          );
          if (!neighborsResponse.ok) {
            console.error(
              "âŒ íƒ€ì¸ì˜ ì´ì›ƒ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:",
              neighborsResponse.status
            );
            return;
          }

          const neighborsData = await neighborsResponse.json();
          const neighbors = neighborsData.neighbors.map((n) => n.urlname); // âœ… ì´ì›ƒë“¤ì˜ urlname ë¦¬ìŠ¤íŠ¸

          console.log("ğŸ”¹ íƒ€ì¸ì˜ ì´ì›ƒ ëª©ë¡:", neighbors);

          // âœ… í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ íƒ€ì¸ì˜ ì´ì›ƒ ëª©ë¡ì— ìˆëŠ”ì§€ í™•ì¸
          if (neighbors.includes(myUrlname)) {
            console.log("âœ… ì„œë¡œ ì´ì›ƒì…ë‹ˆë‹¤.");
            neighborText.innerText = "ì„œë¡œ ì´ì›ƒ"; // ğŸ”¥ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
            neighborButton.style.cursor = "default"; // í´ë¦­ ë¶ˆê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
            neighborButton.style.pointerEvents = "none"; // í´ë¦­ ë°©ì§€
            return;
          }

          console.log("âŒ ì„œë¡œ ì´ì›ƒì´ ì•„ë‹˜.");
        } catch (error) {
          console.error("âŒ ì„œë²„ ì˜¤ë¥˜:", error);
        }

        // ğŸ”¹ ì„œë¡œ ì´ì›ƒ ì‹ ì²­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ì„œë¡œ ì´ì›ƒì´ ì•„ë‹ ë•Œë§Œ ì‹¤í–‰)
        neighborButton.addEventListener("click", async function () {
          console.log("ğŸ”¹ ì´ì›ƒ ì¶”ê°€ ë²„íŠ¼ í´ë¦­ë¨");

          const requestMessage = prompt(
            "ì´ì›ƒ ì‹ ì²­ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”:",
            "ì¹œí•˜ê²Œ ì§€ë‚´ê³  ì‹¶ì–´ìš”!"
          );

          if (!requestMessage) {
            alert("ì´ì›ƒ ì‹ ì²­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");
            return;
          }

          try {
            const requestResponse = await fetch(
              `http://127.0.0.1:8000/neighbors/${encodeURIComponent(
                toUrlname
              )}/`,
              {
                method: "POST",
                headers: {
                  Authorization: `Bearer ${accessToken}`,
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  request_message: requestMessage,
                }),
              }
            );

            if (requestResponse.status === 201) {
              alert("âœ… ì´ì›ƒ ì‹ ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
              neighborText.innerText = "ì„œë¡œ ì´ì›ƒ"; // ğŸ”¥ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
              neighborButton.style.cursor = "default"; // í´ë¦­ ë¶ˆê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
              neighborButton.style.pointerEvents = "none"; // í´ë¦­ ë°©ì§€
            } else {
              console.error("âŒ ì´ì›ƒ ì‹ ì²­ ì‹¤íŒ¨:", requestResponse.status);
              alert("ì´ì›ƒ ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
          } catch (error) {
            console.error("âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜:", error);
            alert("ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          }
        });
      });

      document.addEventListener("DOMContentLoaded", async function () {
        const urlParams = new URLSearchParams(window.location.search);
        const urlname = urlParams.get("urlname"); // ë³€ê²½ëœ ë¶€ë¶„ (user â†’ urlname)
        const accessToken = localStorage.getItem("access_token");

        if (!urlname) {
          console.error("âŒ ì˜¤ë¥˜: urlnameì´ ì—†ìŒ");
          updateBlogUI(null);
          return;
        }

        if (!accessToken) {
          console.warn("âš ï¸ ë¡œê·¸ì¸ í•„ìš”: access_token ì—†ìŒ");
          updateUserStatus(null);
        } else {
          const loggedInUser = await fetchUserInfo();
          updateUserStatus(loggedInUser);
        }

        // í”„ë¡œí•„ ë° ë¸”ë¡œê·¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const profileData = await fetchAPI(
          `profile/${encodeURIComponent(urlname)}/`
        );
        updateBlogUI(profileData);

        // ì¹´í…Œê³ ë¦¬ ê°€ì ¸ì˜¤ê¸°
        const categories = await fetchAPI(
          `category/?urlname=${encodeURIComponent(urlname)}`
        );
        updateCategoryUI(categories);

        // ì„œë¡œì´ì›ƒ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        const neighbors = await fetchAPI(
          `profile/${encodeURIComponent(urlname)}/neighbors/`
        );
        updateNeighborUI(neighbors);

        // í”„ë¡¤ë¡œê·¸ ë§í¬ ì„¤ì •
        setupPrologLink(urlname);
        setupBlogHomeLink(urlname);

        // ê²Œì‹œë¬¼ ê°€ì ¸ì˜¤ê¸°
        fetchPosts(urlname);
      });

      // ğŸ”¹ **API í˜¸ì¶œ í•¨ìˆ˜ (GET ìš”ì²­)**
      async function fetchAPI(endpoint) {
        try {
          const response = await fetch(`http://127.0.0.1:8000/${endpoint}`, {
            method: "GET",
            headers: {
              Accept: "application/json", // ì„œë²„ì—ì„œ ë°›ì•„ì˜¬ ë°ì´í„° í˜•ì‹
              Authorization: `Bearer ${localStorage.getItem("access_token")}`, // í† í° ì „ë‹¬
            },
          });

          if (!response.ok) {
            console.error(
              `âš ï¸ API ìš”ì²­ ì‹¤íŒ¨: ${endpoint} (ìƒíƒœ ì½”ë“œ: ${response.status})`
            );
            return null;
          }

          // ì‘ë‹µ ë°ì´í„°ê°€ categoriesë¥¼ í¬í•¨í•˜ê³  ìˆëŠ”ì§€ í™•ì¸
          const data = await response.json();
          return data; // ì‘ë‹µ ë°ì´í„° ë°˜í™˜
        } catch (error) {
          console.error(`âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜: ${endpoint}`, error);
          return null;
        }
      }

      // ğŸ”¹ **ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°**
      async function fetchUserInfo() {
        try {
          const accessToken = localStorage.getItem("access_token");
          if (!accessToken) return null;

          const response = await fetch("http://127.0.0.1:8000/profile/me/", {
            method: "GET",
            headers: {
              Authorization: `Bearer ${accessToken}`,
              "Content-Type": "application/json",
            },
          });

          if (response.status !== 200) {
            console.warn("âš ï¸ ì‚¬ìš©ì ì •ë³´ ìš”ì²­ ì‹¤íŒ¨ (401 Unauthorized)");
            return null;
          }

          return await response.json();
        } catch (error) {
          console.error("âŒ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:", error);
          return null;
        }
      }

      // ğŸ”¹ **ë¡œê·¸ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸**
      async function updateUserStatus() {
        const loginButton = document.querySelector(".login_btn");

        try {
          const accessToken = localStorage.getItem("access_token");

          if (!accessToken) {
            // ğŸ”¹ ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ê²½ìš°
            updateLoginButtonUI();
            return;
          }

          // ğŸ”¹ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          const userResponse = await fetch(
            "http://127.0.0.1:8000/profile/me/",
            {
              method: "GET",
              headers: {
                Authorization: `Bearer ${accessToken}`,
                "Content-Type": "application/json",
              },
            }
          );

          if (userResponse.status !== 200) {
            console.error("âŒ ì‚¬ìš©ì ì •ë³´ ìš”ì²­ ì‹¤íŒ¨:", userResponse.status);
            updateLoginButtonUI(); // ë¡œê·¸ì¸ ë²„íŠ¼ UI ì—…ë°ì´íŠ¸
            return;
          }

          const userData = await userResponse.json();
          const loggedInUser = userData.username; // ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ë‹‰ë„¤ì„
          const loggedInurl=userData.urlname;

          console.log("ğŸ”¹ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì:", loggedInUser);

          // ğŸ”¹ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ë²„íŠ¼ ë³€ê²½
          if (loginButton) {
            loginButton.textContent = loggedInUser; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
            loginButton.href = `./profile.html?urlname=${encodeURIComponent(loggedInUrl)}`;// í´ë¦­í•˜ë©´ í”„ë¡œí•„ í˜ì´ì§€ë¡œ ì´ë™í•˜ë„ë¡ ë³€ê²½
          }
        } catch (error) {
          console.error("ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:", error);
          updateLoginButtonUI(); // ë¡œê·¸ì¸ ë²„íŠ¼ UI ì—…ë°ì´íŠ¸
        }
      }

      // ğŸ”¹ ë¡œê·¸ì¸ë˜ì§€ ì•Šì•˜ì„ ë•Œ ë²„íŠ¼ ìƒíƒœ ë³€ê²½
      function updateLoginButtonUI() {
        const loginButton = document.querySelector(".login_btn");

        if (loginButton) {
          loginButton.textContent = "ë¡œê·¸ì¸ í•„ìš”"; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
          loginButton.href = "./login.html"; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ë„ë¡ ì„¤ì •
        }
      }

      // ğŸ”¹ í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
      document.addEventListener("DOMContentLoaded", updateUserStatus);

      // ğŸ”¹ **ë¸”ë¡œê·¸ UI ì—…ë°ì´íŠ¸**
      function updateBlogUI(profileData) {
        if (!profileData) {
          document.getElementById("blog-title").innerText =
            "ë¸”ë¡œê·¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
          document.getElementById("blog-intro").innerText =
            "ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
          return;
        }

        document
          .querySelectorAll(".user-nickname")
          .forEach((el) => (el.innerText = profileData.username || "ìµëª…"));
        document
          .querySelectorAll(".user-profilepicture")
          .forEach(
            (img) => (img.src = profileData.user_pic || "assets/profile.png")
          );
        document
          .querySelectorAll(".itemtitlefont")
          .forEach(
            (e2) => (e2.innerText = profileData.blog_name || "ë¸”ë¡œê·¸ëª…")
          );
        document
          .querySelectorAll(".itemfont_col")
          .forEach(
            (e3) =>
              (e3.innerText =
                profileData.intro || "ë¸”ë¡œê·¸ ì†Œê°œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.")
          );
      }

      // ğŸ”¹ **ì¹´í…Œê³ ë¦¬ UI ì—…ë°ì´íŠ¸**
      

      // ğŸ”¹ **í”„ë¡¤ë¡œê·¸ ë§í¬ ì„¤ì •**
      function setupPrologLink(urlname) {
        const prologLink = document.getElementById("prolog-link");
        if (prologLink) {
          prologLink.href = `prolog.html?urlname=${encodeURIComponent(
            urlname
          )}`;
        }
      }

      // ğŸ”¹ **ë¸”ë¡œê·¸ í™ˆ ì„¤ì •**
      function setupBlogHomeLink(urlname) {
        const BlogHomeLink = document.getElementById("bloghome-link");
        if (BlogHomeLink) {
          BlogHomeLink.href = `main_login.html?urlname=${encodeURIComponent(
            urlname
          )}`;
        }
      }

      // ğŸ”¹ **ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥**
      async function logout() {
        try {
          const refreshToken = localStorage.getItem("refresh_token");

          if (!refreshToken) {
            console.error("âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: refresh_token ì—†ìŒ");
            alert("ë¡œê·¸ì¸ ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤.");
            return;
          }

          console.log("ğŸ”¹ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ì „ refresh_token:", refreshToken);

          const response = await fetch("http://127.0.0.1:8000/logout/", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ refresh: refreshToken }),
          });

          console.log("ğŸ”¹ ë¡œê·¸ì•„ì›ƒ ì‘ë‹µ ìƒíƒœ ì½”ë“œ:", response.status);

          if (response.status === 200) {
            console.log("âœ… ë¡œê·¸ì•„ì›ƒ ì„±ê³µ");

            // ğŸ”¹ í† í° ì‚­ì œ
            localStorage.removeItem("access_token");
            localStorage.removeItem("refresh_token");

            alert("ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ!");

            // ğŸ”¹ ë¡œê·¸ì¸ ë²„íŠ¼ì„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
            updateLoginButtonUI();
          } else {
            console.error("âŒ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ì‹¤íŒ¨:", response.status);
            const errorData = await response.json();
            alert(`ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: ${errorData.message || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`);
          }
        } catch (error) {
          console.error("âŒ ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:", error);
          alert("ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
      }

      function updateLoginButtonUI() {
        const loginButton = document.querySelector(".login_btn");

        if (loginButton) {
          loginButton.textContent = "ë¡œê·¸ì¸ í•„ìš”"; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
          loginButton.href = "./login.html"; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ë„ë¡ ì„¤ì •
        }
      }

      // ğŸ”¹ **í”„ë¡œí•„ ì´ë¯¸ì§€ URL ì²˜ë¦¬**
      function getFullMediaUrl(relativeUrl) {
        return relativeUrl
          ? `http://127.0.0.1:8000${relativeUrl}`
          : "assets/default_profile.png";
      }

      document.addEventListener("DOMContentLoaded", async function () {
        const loginButton = document.querySelector(".top_menubar button");
        const accessToken = localStorage.getItem("access_token");

        if (accessToken) {
          try {
            // ğŸ”¹ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const response = await fetch("http://127.0.0.1:8000/profile/me/", {
              method: "GET",
              headers: {
                Authorization: `Bearer ${accessToken}`,
                "Content-Type": "application/json",
              },
            });

            if (response.ok) {
              const data = await response.json();
              const loggedInUser = data.username;
              const loggedInurl=data.urlname;
              // ğŸ”¹ ë²„íŠ¼ì„ ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ë³€ê²½ & í”„ë¡œí•„ í˜ì´ì§€ë¡œ ì´ë™
              loginButton.textContent = loggedInUser;
              loginButton.onclick = () =>
                (location.href = `profile.html?urlname=${encodeURIComponent(
                  loggedInurl
                )}`);
            } else {
              throw new Error("ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
          } catch (error) {
            console.error("âŒ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:", error);
            showLoginButton(); // ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ê±°ë‚˜ ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¡œê·¸ì¸ ë²„íŠ¼ ìœ ì§€
          }
        } else {
          showLoginButton(); // ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ì„ ê²½ìš° ê¸°ë³¸ ë¡œê·¸ì¸ ë²„íŠ¼ í‘œì‹œ
        }

        function showLoginButton() {
          loginButton.textContent = "ë¡œê·¸ì¸";
          loginButton.onclick = () => (location.href = "login.html");
        }
      });

      async function fetchPosts(urlname) {
        if (!urlname) {
          console.error("âŒ urlnameì´ ì—†ìŠµë‹ˆë‹¤.");
          return;
        }

        const accessToken = localStorage.getItem("access_token");

        try {
          const response = await fetch(
            `http://127.0.0.1:8000/posts/?urlname=${encodeURIComponent(
              urlname
            )}`, // ë³€ê²½ëœ ë¶€ë¶„
            {
              method: "GET",
              headers: {
                Authorization: `Bearer ${accessToken}`,
                Accept: "application/json",
              },
            }
          );

          const data = await response.json();

          if (!response.ok) {
            console.error("ê²Œì‹œë¬¼ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            return;
          }

          if (Array.isArray(data)) {
            renderPosts(data);
          } else {
            console.error("ê²Œì‹œê¸€ ëª©ë¡ì´ ë°°ì—´ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.");
          }
        } catch (error) {
          console.error("ğŸ“Œ ê²Œì‹œë¬¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:", error);
        }
      }

      let currentUser = null; // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ì €ì¥

      async function fetchUserInfo() {
        const accessToken = localStorage.getItem("access_token");
        if (!accessToken) {
          console.warn("âš ï¸ ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");
          currentUser = null; // âœ… ë¡œê·¸ì¸ ì•ˆ ëœ ê²½ìš° null ì„¤ì •
          return;
        }

        try {
          const response = await fetch("http://127.0.0.1:8000/profile/me/", {
            method: "GET",
            headers: {
              Authorization: `Bearer ${accessToken}`,
              Accept: "application/json",
            },
          });

          if (!response.ok) {
            console.warn("âš ï¸ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            currentUser = null;
            return;
          }

          const data = await response.json();
          currentUser = data; // âœ… í˜„ì¬ ë¡œê·¸ì¸í•œ ìœ ì € ì •ë³´ ì €ì¥
          console.log("âœ… ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´:", currentUser);
        } catch (error) {
          console.error("ğŸ“Œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:", error);
          currentUser = null;
        }
      }

      function renderPosts(posts) {
        const postContainer = document.querySelector(".post_content");
        postContainer.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

        posts.forEach((post) => {
          const postElement = document.createElement("div");
          postElement.classList.add("post_item");

          // ğŸ”¹ ë‚ ì§œ í¬ë§· ë³€í™˜
          const formattedDate = new Date(post.created_at)
            .toLocaleString("ko-KR", {
              year: "numeric",
              month: "2-digit",
              day: "2-digit",
              hour: "2-digit",
              minute: "2-digit",
            })
            .replace(/\./g, "")
            .replace(" ", ". ")
            .replace("ì˜¤ì „", "")
            .replace("ì˜¤í›„", "")
            .trim();

          // ğŸ”¹ ë³¸ë¬¸ ë‚´ìš© ì •ë¦¬ (ì…ë ¥ í•„ë“œ ì œê±° ë° URL ì •ë¦¬)
          let cleanedContent = removeUnnecessaryButtons(post.content);
          cleanedContent = fixImageUrls(cleanedContent);
          cleanedContent = removeCaptionInputs(cleanedContent);

          // ğŸ”¹ ì´ë¯¸ì§€ íƒœê·¸ë¥¼ `<figure>` íƒœê·¸ë¡œ ë³€í™˜í•˜ì—¬ ìº¡ì…˜ ì¶”ê°€
          if (post.images && post.images.length > 0) {
            post.images.forEach((imageData) => {
              const { image_url, caption } = imageData;

              // âœ… ê¸°ì¡´ <img> íƒœê·¸ë¥¼ ì°¾ì•„ `<figure>`ë¡œ ë³€í™˜
              const imageTag = `
                    <figure style="text-align: center; margin: 15px 0px;">
                        <img src="${fixSingleImageUrl(
                          image_url
                        )}" class="editable-image"
                             style="max-width: 100%; height: auto; margin-top: 10px; border-radius: 5px;">
                        <figcaption style="font-size: 12px; color: gray; margin-top: 5px; text-align: center;">
                            ${caption || "ì´ë¯¸ì§€ ì„¤ëª… ì—†ìŒ"}
                        </figcaption>
                    </figure>
                `;

              cleanedContent = cleanedContent.replace(
                new RegExp(`<img[^>]*src=["']${image_url}["'][^>]*>`, "g"),
                imageTag
              );
            });
          }

          // ğŸ”¹ ë‹‰ë„¤ì„ ì„¤ì • (ë¡œê·¸ì¸ ì•ˆ í•œ ê²½ìš° "ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”" í‘œì‹œ)
          const userNickname = currentUser
            ? currentUser.username
            : "ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”";

          // ğŸ”¹ ê²Œì‹œë¬¼ ì¹´ë“œ ìƒì„±
          postElement.innerHTML = `
            <div class="post_title_content">
                <div class="post_category">${post.category_name}</div>
                <div class="post_title">${post.title}</div>
                <div class="post_writer_list">
                    <strong class="user-nickname" style="color: black;">${post.user_name}</strong>
                    <a>${formattedDate}</a>
                </div>
                <hr class="post_hr">
            </div>
            <div class="post_contents">
                ${cleanedContent}  
            </div>
            <div class="post_last_list">
    <!-- âœ… ì¢‹ì•„ìš” ë²„íŠ¼ -->
    <button class="heart_list" data-id="${post.id}">
        <span class="heart-icon">${post.liked_by_user ? "â¤ï¸" : "ğŸ¤"}</span> ${post.total_likes}
        <span class="heart-dropdown"> â–¼</span>  <!-- âœ… â–¼ ë²„íŠ¼ ì¶”ê°€ (ì´ì›ƒ ëª©ë¡ ë³´ê¸°) -->
    </button>

    <!-- âœ… ëŒ“ê¸€ ë³´ê¸° ë²„íŠ¼ -->
    <span class="comment_toggle_button" data-post-id="${post.id}" style="cursor: pointer;">
        ëŒ“ê¸€ ë³´ê¸°
    </span>
</div>


            <!-- âœ… ëŒ“ê¸€ ì„¹ì…˜ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
            <div id="comment_section_${post.id}" class="comment_section" style="display: none;">
                <h3 class="comment-title">ëŒ“ê¸€</h3>

                <!-- âœ… ëŒ“ê¸€ ëª©ë¡ -->
                <div class="comments-container" id="comments_container_${post.id}">
                    <p>ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>

                <!-- âœ… ëŒ“ê¸€ í˜ì´ì§€ë„¤ì´ì…˜ -->
                <div class="comment_pagination">
                    <ul class="pagination">
                        <li><a href="#" class="active num">1</a></li>
                        <li><a href="#" class="num">2</a></li>
                    </ul>
                </div>

                <!-- âœ… ëŒ“ê¸€ ì‘ì„± ì…ë ¥ì°½ (ì´ˆê¸° ìˆ¨ê¹€) -->
                <div class="comment_write">
                    <a class="cmt_writer_nickname"><strong>${userNickname}</strong></a>
                    <div class="writing_comment">
                        <textarea class="writing_comment_input"
                                  id="comment_input_${post.id}"
                                  placeholder="ë¸”ë¡œê·¸ê°€ ë” í›ˆí›ˆí•´ì§€ëŠ” ëŒ“ê¸€ ë¶€íƒë“œë¦½ë‹ˆë‹¤."></textarea>
                    </div>
                    <hr class="comment_hr" />
                    <div class="comment_btns">
                        <a>ìŠ¤í‹°ì»¤</a><a>ì‚¬ì§„</a><a>ë¹„ë°€ëŒ“ê¸€</a>
                        <button class="submit_cmt" data-post-id="${post.id}"><strong>ë“±ë¡</strong></button>
                    </div>
                </div>
            </div>

            <!-- âœ… ëŒ“ê¸€ CSS ì—°ê²° -->
            <link rel="stylesheet" href="comment.css" />
        `;

          postContainer.appendChild(postElement);
          fetchComments(post.id);
        });

        // âœ… ëŒ“ê¸€ í† ê¸€ ì´ë²¤íŠ¸ ì¶”ê°€
        addCommentToggleEvent();
      }

      //ëŒ“ê¸€ ê´€ë ¨ í•¨ìˆ˜ ëª¨ìŒ

      // âœ… `document`ê°€ ì•„ë‹ˆë¼ `.post_content`ì—ì„œ ì´ë²¤íŠ¸ ìœ„ì„ ì ìš©
      document
        .querySelector(".post_content")
        .addEventListener("click", function (event) {
          if (event.target.classList.contains("submit_cmt")) {
            const postId = event.target.getAttribute("data-post-id");
            const commentInput = document.getElementById(
              `comment_input_${postId}`
            );

            if (!commentInput) {
              console.error(
                `âŒ ëŒ“ê¸€ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (postId: ${postId})`
              );
              return;
            }

            const commentContent = commentInput.value.trim();

            if (!commentContent) {
              alert("ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
              return;
            }

            console.log(
              `ğŸ“Œ submit_cmt ë²„íŠ¼ í´ë¦­ë¨ (postId: ${postId}, ë‚´ìš©: ${commentContent})`
            );

            // âœ… ëŒ“ê¸€ ì‘ì„± í•¨ìˆ˜ ì‹¤í–‰
            submitComment(commentContent, postId);
          }
        });

      //ëŒ“ê¸€ ì—´ê³  ë‹«ê¸° ì´ë²¤íŠ¸
      function addCommentToggleEvent() {
        document
          .querySelectorAll(".comment_toggle_button")
          .forEach((button) => {
            button.addEventListener("click", function () {
              const postId = this.getAttribute("data-post-id");
              toggleCommentSection(postId);
            });
          });
      }

      //ëŒ“ê¸€ ì—´ê³  ë‹«ê¸° ê³¼ì •
      function toggleCommentSection(postId) {
        let commentSection = document.getElementById(
          `comment_section_${postId}`
        );

        if (!commentSection) {
          console.error(`âŒ ëŒ“ê¸€ ì„¹ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (postId: ${postId})`);
          return;
        }

        // âœ… ëŒ“ê¸€ ì˜ì—­ ë³´ì´ê¸° / ìˆ¨ê¸°ê¸°
        commentSection.style.display =
          commentSection.style.display === "none" ? "block" : "none";

        console.log(
          `âœ… ëŒ“ê¸€ ì˜ì—­ ìƒíƒœ (${postId}): ${commentSection.style.display}`
        );

        // âœ… ì²˜ìŒ ì—´ë¦´ ë•Œ ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
        if (commentSection.style.display === "block") {
          fetchComments(postId);
        }
      }

      /** âœ… íŠ¹ì • ê²Œì‹œë¬¼ ëŒ“ê¸€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° */
      async function fetchComments(postId) {
        console.log(`âœ… fetchComments() ì‹¤í–‰ë¨ (postId: ${postId})`);

        const commentContainer = document.getElementById(
          `comments_container_${postId}`
        );
        if (!commentContainer) {
          console.error(
            "âŒ `.comments-container` ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
          );
          return;
        }

        try {
          const response = await fetch(
            `http://127.0.0.1:8000/posts/${postId}/comments/`,
            {
              method: "GET",
              headers: { "Content-Type": "application/json" },
            }
          );

          if (!response.ok)
            throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ ì½”ë“œ: ${response.status}`);

          const comments = await response.json();
          console.log(`âœ… ê²Œì‹œë¬¼ ID ${postId}ì˜ ëŒ“ê¸€ ëª©ë¡:`, comments);

          renderComments(comments, postId);
        } catch (error) {
          console.error("âŒ ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
        }
      }

      //ê°€ì ¸ì˜¨ ëŒ“ê¸€ í™”ë©´ì— ë Œë”ë§
      /** âœ… ëŒ“ê¸€ ë Œë”ë§ (ëŒ€ëŒ“ê¸€ í¬í•¨) */
      function renderComments(comments, postId) {
        const commentContainer = document.getElementById(
          `comments_container_${postId}`
        );
        if (!commentContainer) {
          console.error(
            "âŒ `.comments-container` ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ ëŒ“ê¸€ì„ ë Œë”ë§í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
          );
          return;
        }

        commentContainer.innerHTML = "";

        if (comments.length === 0) {
          commentContainer.style.display = "none";
          return;
        }

        commentContainer.style.display = "block";

        comments.forEach((comment) => {
          const commentElement = createCommentElement(comment, postId);
          commentContainer.appendChild(commentElement);

          // âœ… ëŒ€ëŒ“ê¸€ì´ ì¡´ì¬í•˜ë©´ ì¬ê·€ì ìœ¼ë¡œ ì¶”ê°€
          if (comment.replies && comment.replies.length > 0) {
            const replyContainer = document.createElement("div");
            replyContainer.classList.add("replies-container");
            replyContainer.style.marginLeft = "20px"; // ë“¤ì—¬ì“°ê¸° ìŠ¤íƒ€ì¼ ì ìš©
            commentElement.appendChild(replyContainer);

            comment.replies.forEach((reply) => {
              replyContainer.appendChild(
                createCommentElement(reply, postId, 1)
              ); // âœ… ë“¤ì—¬ì“°ê¸° ì ìš©
            });
          }
        });
      }

      /** âœ… ëŒ“ê¸€ ì‘ì„± ìš”ì²­ */
      async function submitComment(content, postId, parentId = null) {
        console.log("ğŸ“Œ submitComment() ì‹¤í–‰ë¨", { content, postId, parentId });

        const accessToken = localStorage.getItem("access_token");
        if (!accessToken) {
          alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
          return;
        }

        try {
          const response = await fetch(
            `http://127.0.0.1:8000/posts/${postId}/comments/`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${accessToken}`,
              },
              body: JSON.stringify({
                content: content,
                parent: parentId || null, // âœ… ëŒ€ëŒ“ê¸€ì¸ ê²½ìš° ë¶€ëª¨ ID í¬í•¨
              }),
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ ì½”ë“œ: ${response.status}`);
          }

          const newComment = await response.json();
          console.log("âœ… ëŒ“ê¸€ ì‘ì„± ì„±ê³µ:", newComment);

          // âœ… ì…ë ¥ì°½ ì´ˆê¸°í™”
          if (!parentId) {
            document.getElementById(`comment_input_${postId}`).value = "";
          } else {
            document.querySelector(
              `#reply_form_${parentId} .reply_input`
            ).value = "";
          }

          // âœ… ìƒˆ ëŒ“ê¸€ ì¦‰ì‹œ ë Œë”ë§
          addNewCommentToList(newComment, postId, parentId);
        } catch (error) {
          console.error("âŒ ëŒ“ê¸€ ì‘ì„± ì‹¤íŒ¨:", error);
          alert("ëŒ“ê¸€ì„ ì €ì¥í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      /** âœ… ìƒˆ ëŒ“ê¸€ì„ ëª©ë¡ì— ì¦‰ì‹œ ì¶”ê°€ */
      function addNewCommentToList(comment, postId, parentId = null) {
        let commentContainer = document.getElementById(
          `comments_container_${postId}`
        );

        // âœ… ëŒ“ê¸€ ì»¨í…Œì´ë„ˆê°€ ì—†ìœ¼ë©´ ìƒì„±
        if (!commentContainer) {
          commentContainer = document.createElement("div");
          commentContainer.classList.add("comments-container");
          document
            .getElementById(`comment_section_${postId}`)
            .appendChild(commentContainer);
        }

        // âœ… ì²« ëŒ“ê¸€ì´ ì¶”ê°€ë  ë•Œ, ëŒ“ê¸€ ì»¨í…Œì´ë„ˆë¥¼ í‘œì‹œ
        commentContainer.style.display = "block";

        const newCommentElement = createCommentElement(comment, postId);

        if (!parentId) {
          // âœ… ì¼ë°˜ ëŒ“ê¸€ì¸ ê²½ìš°, ì „ì²´ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
          commentContainer.appendChild(newCommentElement);
        } else {
          // âœ… ëŒ€ëŒ“ê¸€ì¸ ê²½ìš°, ë¶€ëª¨ ëŒ“ê¸€ ì•„ë˜ ì¶”ê°€
          const parentComment = document.querySelector(
            `[data-comment-id="${parentId}"]`
          );
          if (parentComment) {
            let replyContainer =
              parentComment.querySelector(".replies-container");

            // âœ… ëŒ€ëŒ“ê¸€ ì»¨í…Œì´ë„ˆê°€ ì—†ìœ¼ë©´ ìƒì„±
            if (!replyContainer) {
              replyContainer = document.createElement("div");
              replyContainer.classList.add("replies-container");
              replyContainer.style.marginLeft = "20px"; // ë“¤ì—¬ì“°ê¸°
              parentComment.appendChild(replyContainer);
            }

            replyContainer.appendChild(newCommentElement);
          }
        }
      }

      /** âœ… ëŒ“ê¸€ ë° ëŒ€ëŒ“ê¸€ ìš”ì†Œ ìƒì„± */
      function createCommentElement(comment, postId, depth = 0) {
        const commentElement = document.createElement("div");
        commentElement.classList.add("writed_comments");
        commentElement.setAttribute("data-comment-id", comment.id);
        commentElement.style.marginLeft = `${depth * 20}px`; // âœ… ëŒ€ëŒ“ê¸€ ë“¤ì—¬ì“°ê¸°

        // âœ… ë³¸ì¸ ëŒ“ê¸€ ì—¬ë¶€ í™•ì¸ (í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ê¸°ë³¸ í•„í„°ë§)
        const isOwnComment =
          currentUser && currentUser.username === comment.author_name;

        commentElement.innerHTML = `
        <div class="comment-header">
            <a class="cmt_writer_nickname"><strong>${
              comment.author_name || "ìµëª…"
            }</strong></a>
            <span class="comment-date">${new Date(
              comment.created_at
            ).toLocaleString("ko-KR")}</span>
        </div>
        <div class="writing_comment" id="comment_text_${comment.id}">
            ${comment.is_private ? "<i>ë¹„ë°€ ëŒ“ê¸€ì…ë‹ˆë‹¤.</i>" : comment.content}
        </div>
        <div class="comment_btns">
            <a class="reply_btn" data-comment-id="${
              comment.id
            }"><strong>ë‹µê¸€</strong></a>
            ${
              isOwnComment
                ? `<a class="edit_btn" data-comment-id="${comment.id}"><strong>ìˆ˜ì •</strong></a>
            <a class="delete_btn" data-comment-id="${comment.id}"><strong>ì‚­ì œ</strong></a>`
                : ""
            }
        </div>
        <div class="reply_form" id="reply_form_${
          comment.id
        }" style="display:none;">
            <textarea class="reply_input" placeholder="ëŒ€ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            <button class="submit_reply" data-parent-id="${
              comment.id
            }">ë“±ë¡</button>
        </div>
        <hr>
    `;

        // âœ… "ë‹µê¸€" ë²„íŠ¼ í´ë¦­ ì‹œ ëŒ€ëŒ“ê¸€ ì…ë ¥ì°½ í‘œì‹œ
        commentElement
          .querySelector(".reply_btn")
          .addEventListener("click", function () {
            const replyForm = document.getElementById(
              `reply_form_${comment.id}`
            );
            replyForm.style.display =
              replyForm.style.display === "none" ? "block" : "none";
          });

        // âœ… "ìˆ˜ì •" ë²„íŠ¼ í´ë¦­ ì‹œ ëŒ“ê¸€ ìˆ˜ì • ëª¨ë“œ
        if (isOwnComment) {
          commentElement
            .querySelector(".edit_btn")
            .addEventListener("click", function () {
              editComment(comment.id, postId);
            });

          // âœ… "ì‚­ì œ" ë²„íŠ¼ í´ë¦­ ì‹œ ëŒ“ê¸€ ì‚­ì œ
          commentElement
            .querySelector(".delete_btn")
            .addEventListener("click", function () {
              deleteComment(comment.id, postId);
            });
        }

        // âœ… ëŒ€ëŒ“ê¸€ ë“±ë¡ ì´ë²¤íŠ¸ ì¶”ê°€
        commentElement
          .querySelector(".submit_reply")
          .addEventListener("click", function () {
            const replyContent = commentElement
              .querySelector(".reply_input")
              .value.trim();
            if (replyContent) submitComment(replyContent, postId, comment.id);
          });

        return commentElement;
      }

      /** âœ… ëŒ“ê¸€ ìˆ˜ì • ê¸°ëŠ¥ */
      function editComment(commentId, postId) {
        const commentText = document.getElementById(
          `comment_text_${commentId}`
        );
        const originalContent = commentText.innerHTML.trim();

        // âœ… ê¸°ì¡´ ë‚´ìš©ì„ ì…ë ¥ì°½ìœ¼ë¡œ ë³€ê²½
        commentText.innerHTML = `
        <textarea class="edit_comment_input">${originalContent}</textarea>
        <button class="save_edit_btn" data-comment-id="${commentId}">ì €ì¥</button>
        <button class="cancel_edit_btn" data-comment-id="${commentId}">ì·¨ì†Œ</button>
    `;

        // âœ… "ì €ì¥" ë²„íŠ¼ í´ë¦­ ì‹œ ìˆ˜ì • ìš”ì²­
        document
          .querySelector(`.save_edit_btn[data-comment-id="${commentId}"]`)
          .addEventListener("click", function () {
            const newContent = document
              .querySelector(`.edit_comment_input`)
              .value.trim();
            if (newContent) updateComment(commentId, postId, newContent);
          });

        // âœ… "ì·¨ì†Œ" ë²„íŠ¼ í´ë¦­ ì‹œ ì›ë˜ ë‚´ìš© ë³µêµ¬
        document
          .querySelector(`.cancel_edit_btn[data-comment-id="${commentId}"]`)
          .addEventListener("click", function () {
            commentText.innerHTML = originalContent;
          });
      }

      /** âœ… ëŒ“ê¸€ ìˆ˜ì • ìš”ì²­ (PATCH) */
      async function updateComment(commentId, postId, newContent) {
        console.log("ğŸ“Œ ëŒ“ê¸€ ìˆ˜ì • ìš”ì²­:", { commentId, postId, newContent });

        const accessToken = localStorage.getItem("access_token");
        if (!accessToken) {
          alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
          return;
        }

        try {
          const response = await fetch(
            `http://127.0.0.1:8000/posts/${postId}/comments/${commentId}/`,
            {
              method: "PATCH",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${accessToken}`,
              },
              body: JSON.stringify({ content: newContent }),
            }
          );

          if (!response.ok)
            throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ ì½”ë“œ: ${response.status}`);

          const updatedComment = await response.json();
          console.log("âœ… ëŒ“ê¸€ ìˆ˜ì • ì„±ê³µ:", updatedComment);

          // âœ… ìˆ˜ì •ëœ ëŒ“ê¸€ì„ í™”ë©´ì— ë°˜ì˜
          document.getElementById(`comment_text_${commentId}`).innerHTML =
            updatedComment.content;
        } catch (error) {
          console.error("âŒ ëŒ“ê¸€ ìˆ˜ì • ì‹¤íŒ¨:", error);
          alert("ëŒ“ê¸€ì„ ìˆ˜ì •í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      /** âœ… ëŒ“ê¸€ ì‚­ì œ ìš”ì²­ (DELETE) */
      async function deleteComment(commentId, postId) {
        console.log("ğŸ“Œ ëŒ“ê¸€ ì‚­ì œ ìš”ì²­:", { commentId, postId });

        const accessToken = localStorage.getItem("access_token");
        if (!accessToken) {
          alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
          return;
        }

        if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        try {
          const response = await fetch(
            `http://127.0.0.1:8000/posts/${postId}/comments/${commentId}/`,
            {
              method: "DELETE",
              headers: {
                Authorization: `Bearer ${accessToken}`,
              },
            }
          );

          if (!response.ok)
            throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ ì½”ë“œ: ${response.status}`);

          console.log("âœ… ëŒ“ê¸€ ì‚­ì œ ì„±ê³µ");
          document.querySelector(`[data-comment-id="${commentId}"]`).remove();
        } catch (error) {
          console.error("âŒ ëŒ“ê¸€ ì‚­ì œ ì‹¤íŒ¨:", error);
          alert("ëŒ“ê¸€ì„ ì‚­ì œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      function fixImageUrls(htmlContent) {
        const baseUrl = "http://127.0.0.1:8000";
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = htmlContent;

        tempDiv.querySelectorAll("img").forEach((img) => {
          const imgSrc = img.getAttribute("src");
          if (imgSrc && !imgSrc.startsWith("http")) {
            img.src = baseUrl + imgSrc;
          }
        });

        return tempDiv.innerHTML;
      }

      function fixSingleImageUrl(imageUrl) {
        const baseUrl = "http://127.0.0.1:8000";
        return imageUrl.startsWith("http") ? imageUrl : baseUrl + imageUrl;
      }

      function removeUnnecessaryButtons(htmlContent) {
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = htmlContent;

        tempDiv.querySelectorAll("button").forEach((button) => {
          if (button.textContent.trim() === "ëŒ€í‘œì‚¬ì§„ ì„ íƒ") {
            button.remove();
          }
        });

        return tempDiv.innerHTML;
      }

      // âœ… `figcaption` ë‚´ `<input>` í•„ë“œë¥¼ ì œê±°í•˜ëŠ” í•¨ìˆ˜ ì¶”ê°€
      function removeCaptionInputs(htmlContent) {
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = htmlContent;

        tempDiv.querySelectorAll("figcaption input").forEach((input) => {
          const parentFigcaption = input.parentNode;
          parentFigcaption.innerHTML = ""; // ê¸°ì¡´ `<input>`ì„ ì‚­ì œí•˜ê³  ë¹„ì›Œë‘ 
        });

        return tempDiv.innerHTML;
      }
      function removeUnnecessaryButtons(htmlContent) {
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = htmlContent;

        tempDiv.querySelectorAll("button").forEach((button) => {
          if (button.textContent.trim() === "ëŒ€í‘œì‚¬ì§„ ì„ íƒ") {
            button.remove();
          }
        });

        return tempDiv.innerHTML;
      }

      // âœ… ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì—ì„œ `urlname` ê°’ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
      function getUrlParameter(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name)
          ? decodeURIComponent(urlParams.get(name))
          : null;
      }

      document.addEventListener("DOMContentLoaded", async function () {
        try {
          const urlname = getUrlParameter("urlname"); // âœ… URLì—ì„œ `urlname` ê°’ ê°€ì ¸ì˜¤ê¸°

          if (!urlname) {
            console.error("âŒ urlnameì„ ì°¾ì„ ìˆ˜ ì—†ìŒ.");
            return;
          }

          // âœ… í”„ë¡œí•„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          const profileResponse = await fetch(
            `http://127.0.0.1:8000/profile/${urlname}/`
          );
          if (!profileResponse.ok) {
            console.error(
              "âŒ í”„ë¡œí•„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:",
              profileResponse.status
            );
            return;
          }
          const profileData = await profileResponse.json();
          const username = profileData.username;

          // âœ… í”„ë¡œí•„ UI ì—…ë°ì´íŠ¸
          const usernameElement = document.querySelector(
            ".neighbor-profile .user-nickname strong"
          );
          if (usernameElement) {
            usernameElement.innerText = username;
          }

          // âœ… ê²Œì‹œê¸€ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (ê²Œì‹œê¸€ ìœ ì§€)
          fetchPosts(urlname);

          // âœ… ì´ì›ƒ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
          const neighborsResponse = await fetch(
            `http://127.0.0.1:8000/profile/${urlname}/neighbors/`
          );
          if (!neighborsResponse.ok) {
            console.error(
              "âŒ ì´ì›ƒ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:",
              neighborsResponse.status
            );
            return;
          }
          const neighborsData = await neighborsResponse.json();
          const neighbors = neighborsData.neighbors;

          // âœ… ì´ì›ƒ ìˆ˜ ê°€ì ¸ì˜¤ê¸°
          const countResponse = await fetch(
            `http://127.0.0.1:8000/neighbors/count/${urlname}/`
          );
          if (!countResponse.ok) {
            console.error("âŒ ì´ì›ƒ ìˆ˜ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", countResponse.status);
            return;
          }
          const countData = await countResponse.json();
          const neighborCount = countData.neighbor_count;

          document.getElementById("neighbor-count").innerText = neighborCount;

          // âœ… ì´ì›ƒ ëª©ë¡ í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
          const neighborContainer =
            document.getElementById("neighbor-container");
          if (!neighborContainer) {
            console.error("âŒ neighbor-container ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ.");
            return;
          }

          const pageIndicator = document.getElementById("page-indicator");
          const prevPageBtn = document.getElementById("prev-page");
          const nextPageBtn = document.getElementById("next-page");

          let currentPage = 1;
          const itemsPerPage = 12;
          const totalPages = Math.ceil(neighbors.length / itemsPerPage);

          async function renderNeighbors(page) {
            neighborContainer.innerHTML = ""; // âœ… ì´ì›ƒ ëª©ë¡ë§Œ ì´ˆê¸°í™” (ê²Œì‹œê¸€ ì‚­ì œ ë°©ì§€)
            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageNeighbors = neighbors.slice(start, end);

            // âœ… í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const loggedInUser = await fetchUserInfo();
            const loggedInUrlname = loggedInUser ? loggedInUser.urlname : null;

            pageNeighbors.forEach((neighbor) => {
              const { urlname, username, user_pic } = neighbor;
              const imageUrl = user_pic.startsWith("/media")
                ? `http://127.0.0.1:8000${user_pic}`
                : user_pic;
              const targetPage =
                loggedInUrlname === urlname
                  ? "myblog.html"
                  : `blog.html?urlname=${encodeURIComponent(urlname)}`;

              const neighborHtml = `
                    <div class="neighbor-item" style="text-align: center;">
                        <a href="${targetPage}">
                            <div class="neighbor-img">
                                <img src="${imageUrl}" alt="${username}" style="cursor: pointer;">
                            </div>
                        </a>
                        <a href="${targetPage}" style="text-decoration: none; color: inherit;">
                            <span class="neighbor-nickname" style="cursor: pointer;">${username}</span>
                        </a>
                    </div>
                `;
              neighborContainer.innerHTML += neighborHtml;
            });

            pageIndicator.innerText = `${currentPage} / ${totalPages}`;
          }

          prevPageBtn.addEventListener("click", () => {
            if (currentPage > 1) {
              currentPage--;
              renderNeighbors(currentPage);
            }
          });

          nextPageBtn.addEventListener("click", () => {
            if (currentPage < totalPages) {
              currentPage++;
              renderNeighbors(currentPage);
            }
          });

          renderNeighbors(currentPage);
        } catch (error) {
          console.error("âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜:", error);
        }
      });


      document.addEventListener("DOMContentLoaded", function () {
    console.log("ğŸ“¢ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ");

    // âœ… ì´ë²¤íŠ¸ ìœ„ì„: ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ê°ì§€
    document.body.addEventListener("click", async function (event) {
        // â¤ï¸/ğŸ¤ ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­
        if (event.target.closest(".heart_list")) {
            const heartButton = event.target.closest(".heart_list");
            const postId = heartButton.getAttribute("data-id");

            if (!postId) {
                console.error("âŒ postIdê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            console.log(`ğŸ”¥ ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ë¨ (postId: ${postId})`);
            await toggleLike(postId, heartButton);
        }

        // â–¼ ë²„íŠ¼ í´ë¦­ (ì´ì›ƒ ëª©ë¡ ë³´ê¸°)
        if (event.target.closest(".heart-dropdown")) {
            event.stopPropagation();
            const heartButton = event.target.closest(".heart_list");
            const postId = heartButton.getAttribute("data-id");

            if (!postId) {
                console.error("âŒ postIdê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            console.log(`ğŸ“¢ â–¼ ë²„íŠ¼ í´ë¦­ë¨ (postId: ${postId})`);
            await showNeighborList(postId, heartButton);
        }
    });
});

// âœ… ì¢‹ì•„ìš”(ê³µê°) í† ê¸€ ê¸°ëŠ¥
async function toggleLike(postId, heartButton) {
    const url = `http://127.0.0.1:8000/posts/${postId}/heart/`;
    const accessToken = localStorage.getItem("access_token");

    if (!accessToken) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        return;
    }

    try {
        console.log(`ğŸ”¥ ì¢‹ì•„ìš” ìš”ì²­: ${url}`);

        const response = await fetch(url, {
            method: "POST",
            headers: {
                Authorization: `Bearer ${accessToken}`,
                "Content-Type": "application/json",
            },
        });

        const result = await response.json();
        console.log("ğŸ“¢ ì„œë²„ ì‘ë‹µ:", result);

        if (!response.ok) {
            console.error(`âŒ ì¢‹ì•„ìš” ìš”ì²­ ì‹¤íŒ¨ (HTTP ${response.status})`);
            return;
        }

        // âœ… ì¢‹ì•„ìš” ìƒíƒœ ì—…ë°ì´íŠ¸
        if (result.like_count !== undefined) {
            const isLiked = result.message === "í•˜íŠ¸ ì¶”ê°€";
            console.log(`ğŸ”¥ ì¢‹ì•„ìš” ìƒíƒœ ë³€ê²½: ${isLiked ? "â¤ï¸" : "ğŸ¤"}`);

            // âœ… í•˜íŠ¸ ë²„íŠ¼ UI ì—…ë°ì´íŠ¸
            heartButton.innerHTML = `
                <span class="heart-icon">${isLiked ? "â¤ï¸" : "ğŸ¤"}</span> ${result.like_count}
                <span class="heart-dropdown"> â–¼</span>  <!-- â–¼ ë²„íŠ¼ ìœ ì§€ (ì´ì›ƒ ëª©ë¡ ë³´ê¸°) -->
            `;
        } else {
            console.error("âŒ ì„œë²„ ì‘ë‹µì— like_count ì—†ìŒ:", result);
        }
    } catch (error) {
        console.error("âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜:", error);
    }
}

// âœ… ì´ì›ƒ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° & íŒì—… í‘œì‹œ (â–¼ ë²„íŠ¼ í´ë¦­ ì‹œ)
async function showNeighborList(postId, heartButton) {
    const url = `http://127.0.0.1:8000/posts/${postId}/neighbors/`;
    const accessToken = localStorage.getItem("access_token");

    if (!accessToken) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        return;
    }

    try {
        console.log(`ğŸ“¢ ì´ì›ƒ ëª©ë¡ ìš”ì²­: ${url}`);

        const response = await fetch(url, {
            method: "GET",
            headers: {
                Authorization: `Bearer ${accessToken}`,
                "Content-Type": "application/json",
            },
        });

        if (!response.ok) {
            console.error(`âŒ ì´ì›ƒ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨ (HTTP ${response.status})`);
            return;
        }

        const result = await response.json();
        console.log("ğŸ“¢ ì´ì›ƒ ëª©ë¡:", result);

        createNeighborPopup(result.neighbors, heartButton);

    } catch (error) {
        console.error("âŒ ì´ì›ƒ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:", error);
    }
}

// âœ… ì´ì›ƒ ëª©ë¡ì„ íŒì—…ìœ¼ë¡œ í‘œì‹œ
function createNeighborPopup(neighbors, heartButton) {
    // ê¸°ì¡´ íŒì—… ì œê±° (ì¤‘ë³µ ë°©ì§€)
    document.querySelectorAll(".neighbor-popup").forEach(popup => popup.remove());

    if (!neighbors || neighbors.length === 0) {
        alert("ì•„ì§ ì´ì›ƒì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    // íŒì—… ìƒì„±
    const popup = document.createElement("div");
    popup.classList.add("neighbor-popup");
    popup.innerHTML = `
        <div class="popup-header">
            <span>ì´ì›ƒ ëª©ë¡</span>
            <button class="close-popup">âœ–</button>
        </div>
        <div class="popup-content">
            ${neighbors.map(user => `
                <div class="neighbor-user">
                    <img src="http://127.0.0.1:8000${user.user_pic}" alt="${user.username}" class="user-pic">
                    <span class="user-name">${user.username}</span>
                </div>
            `).join('')}
        </div>
    `;

    // ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€
    popup.querySelector(".close-popup").addEventListener("click", () => popup.remove());

    // heartButton ìœ„ì¹˜ ê¸°ì¤€ìœ¼ë¡œ íŒì—… ìœ„ì¹˜ ì„¤ì •
    document.body.appendChild(popup);
    const rect = heartButton.getBoundingClientRect();
    popup.style.position = "absolute";
    popup.style.top = `${rect.bottom + window.scrollY + 5}px`;
    popup.style.left = `${rect.left + window.scrollX}px`;
}

    </script>
  </body>
</html>

